<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>股友 - 智能鑫AI</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #1a73e8;
            --primary-dark: #0d47a1;
            --secondary: #34a853;
            --accent: #fbbc05;
            --danger: #ea4335;
            --light-bg: #f8f9fa;
            --card-bg: #ffffff;
            --text-primary: #202124;
            --text-secondary: #5f6368;
            --border-color: #dadce0;
            --shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
            --shadow-hover: 0 6px 16px rgba(0, 0, 0, 0.1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "PingFang SC", "Microsoft YaHei", "Helvetica Neue", sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        
        html, body {
            height: 100%;
            overflow: hidden;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e8f0 100%);
            color: var(--text-primary);
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .phone-container {
            width: 390px;
            height: 844px;
            background: white;
            border-radius: 40px;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
            position: relative;
            border: 12px solid #111;
        }
        
        .phone-screen {
            width: 100%;
            height: 100%;
            position: relative;
            overflow: hidden;
        }
        
        .status-bar {
            height: 48px;
            background: #1a73e8;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 24px;
            font-size: 15px;
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            padding-top: 12px;
        }
        
        .status-left {
            display: flex;
            align-items: center;
            gap: 5px;
            font-weight: 600;
        }
        
        .status-time {
            font-weight: 600;
        }
        
        .status-icons {
            display: flex;
            gap: 10px;
        }
        
        .fixed-header {
            position: absolute;
            top: 48px;
            left: 0;
            right: 0;
            background: linear-gradient(90deg, var(--primary) 0%, var(--primary-dark) 100%);
            padding: 18px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: white;
            z-index: 999;
            height: 68px;
            box-shadow: 0 4px 12px rgba(26, 115, 232, 0.2);
        }

        .header-content {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .user-info {
            font-size: 15px;
            font-weight: 500;
            color: white;
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(255, 255, 255, 0.15);
            padding: 10px 18px;
            border-radius: 24px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .user-info:hover {
            background: rgba(255, 255, 255, 0.25);
        }

        .header-dropdown {
            position: relative;
        }

        .header-dropdown-menu {
            right: 0;
            left: auto;
        }

        .header-dropdown-btn {
            width: 36px;
            height: 36px;
            background: rgba(255, 255, 255, 0.15);
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .header-dropdown-btn:hover {
            background: rgba(255, 255, 255, 0.25);
        }

        .header-dropdown-menu {
            position: absolute;
            top: calc(100% + 8px);
            right: 0;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            border: 1px solid var(--border-color);
            min-width: 140px;
            z-index: 1000;
            overflow: hidden;
            display: none;
        }

        .header-dropdown-menu.show {
            display: block;
        }

        .dropdown-item {
            padding: 12px 16px;
            font-size: 14px;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .dropdown-item:hover {
            background: rgba(26, 115, 232, 0.05);
        }

        .dropdown-item i {
            color: var(--primary);
            font-size: 16px;
        }
        
        .back-btn {
            width: 36px;
            height: 36px;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            text-decoration: none;
            transition: all 0.2s;
            font-size: 16px;
            font-weight: 400;
        }
        
        .back-btn:hover {
            background: rgba(255, 255, 255, 0.25);
        }
        
        .page-title {
            font-size: 20px;
            font-weight: 700;
            flex: 1;
            text-align: center;
            margin: 0 12px;
        }
        
        .header-actions {
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .add-friend-btn {
            padding: 4px 8px;
            background: rgba(255, 255, 255, 0.15);
            border: none;
            border-radius: 16px;
            color: white;
            font-size: 11px;
            font-weight: 400;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 2px;
            white-space: nowrap;
        }
        
        .add-friend-btn:hover {
            background: rgba(255, 255, 255, 0.25);
        }
        
        .search-btn {
            width: 30px;
            height: 30px;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            text-decoration: none;
            transition: all 0.2s;
            font-size: 12px;
            font-weight: 400;
        }
        
        .search-btn:hover {
            background: rgba(255, 255, 255, 0.25);
        }
        
        /* 优化图标大小 */
        .add-friend-btn i {
            font-size: 10px;
            font-weight: 400;
        }
        
        .search-btn i {
            font-size: 14px;
            font-weight: 400;
        }
        
        /* 好友头像容器 */
        .friend-avatar-container {
            position: relative;
            cursor: pointer;
            flex-shrink: 0;
            margin-right: 16px;
        }
        
        /* 好友操作下拉按钮 */
        .friend-actions-dropdown {
            position: absolute;
            top: 0;
            right: 0;
            width: 18px;
            height: 18px;
            background: rgba(0, 0, 0, 0.6);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            cursor: pointer;
            z-index: 10;
        }
        
        /* 确保好友列表项的布局正确 */
        .friend-item {
            display: flex;
            align-items: center;
            padding: 16px;
        }
        
        .friend-avatar {
            margin-right: 0;
        }
        
        /* 消息头像容器样式 */
        .message-avatar-container {
            position: relative;
            cursor: pointer;
            flex-shrink: 0;
            margin-right: 16px;
        }
        
        .message-item {
            display: flex;
            align-items: center;
            cursor: pointer;
            z-index: 1;
        }
        
        /* 确保下拉按钮能正确点击 */
        .friend-actions-dropdown {
            position: absolute;
            top: 0;
            right: 0;
            width: 18px;
            height: 18px;
            background: rgba(0, 0, 0, 0.6);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            cursor: pointer;
            z-index: 10;
        }
        
        /* 好友操作菜单 */
        .friend-actions-menu {
            position: absolute;
            top: calc(100% + 4px);
            right: 0;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            border: 1px solid var(--border-color);
            min-width: 120px;
            z-index: 1000;
            overflow: hidden;
        }
        
        /* 菜单项 */
        .menu-item {
            padding: 10px 16px;
            font-size: 14px;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .menu-item:hover {
            background: rgba(26, 115, 232, 0.05);
        }
        
        .menu-item.danger {
            color: var(--danger);
        }
        
        .menu-item.danger:hover {
            background: rgba(234, 67, 53, 0.05);
        }
        
        .scrollable-content {
            position: absolute;
            top: 116px;
            bottom: 60px;
            left: 0;
            right: 0;
            overflow-y: auto;
            overflow-x: hidden;
            -webkit-overflow-scrolling: touch;
            padding: 10px 15px 15px;
        }
        
        .chat-tabs {
            display: flex;
            background: var(--card-bg);
            border-radius: 16px;
            padding: 6px;
            margin: 10px 0;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
        }
        
        .chat-tab {
            flex: 1;
            text-align: center;
            padding: 10px 8px;
            font-size: 15px;
            color: var(--text-secondary);
            text-decoration: none;
            border-radius: 12px;
            transition: all 0.2s;
            font-weight: 600;
        }
        
        .chat-tab.active {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            box-shadow: 0 2px 6px rgba(26, 115, 232, 0.2);
        }
        
        .tab-content {
            display: block;
        }
        
        .message-list, .friend-list {
            margin-top: 5px;
        }
        
        .message-item, .friend-item {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 12px;
            margin-bottom: 10px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            text-decoration: none;
            color: var(--text-primary);
            transition: all 0.3s;
        }
        
        .message-item:hover, .friend-item:hover {
            box-shadow: var(--shadow-hover);
            border-color: rgba(26, 115, 232, 0.2);
            transform: translateY(-2px);
        }
        
        .message-avatar, .friend-avatar {
            width: 52px;
            height: 52px;
            border-radius: 14px;
            background: linear-gradient(135deg, #e8f0fe 0%, #f1f8ff 100%);
            margin-right: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            color: var(--primary);
            font-weight: 700;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
        }
        
        .message-content, .friend-info {
            flex: 1;
        }
        
        .message-header, .friend-info > div:first-child {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .message-name, .friend-name {
            font-size: 15px;
            font-weight: 400;
            color: var(--text-primary);
            margin-bottom: 4px;
        }
        
        .message-time, .friend-status {
            font-size: 12px;
            color: var(--text-secondary);
        }
        
        .friend-status.online {
            color: var(--secondary);
            font-weight: 600;
        }
        
        .message-preview {
            font-size: 14px;
            color: var(--text-secondary);
            line-height: 1.4;
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 1;
            -webkit-box-orient: vertical;
        }
        
        .unread-badge {
            background: var(--danger);
            color: white;
            border-radius: 20px;
            padding: 4px 10px;
            font-size: 12px;
            font-weight: 700;
            min-width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-left: 12px;
        }
        
        .friend-actions {
            margin-left: 12px;
        }

        .action-btn {
            padding: 8px 20px;
            border: 1px solid var(--primary);
            color: var(--primary);
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            background: transparent;
            cursor: pointer;
            transition: all 0.2s;
            margin-left: 8px;
        }

        .action-btn:hover {
            background: var(--primary);
            color: white;
        }
        
        .action-btn.danger {
            border-color: var(--danger);
            color: var(--danger);
        }
        
        .action-btn.danger:hover {
            background: var(--danger);
            color: white;
        }
        
        .action-btn.secondary {
            border-color: var(--secondary);
            color: var(--secondary);
        }
        
        .action-btn.secondary:hover {
            background: var(--secondary);
            color: white;
        }
        
        /* 好友操作按钮组 */
        .friend-more-actions {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-left: auto;
        }
        
        /* 群组操作按钮组 */
        .group-more-actions {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-left: auto;
        }
        
        /* 操作按钮容器 */
        .actions-container {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        /* 优化好友列表项布局 */
        .friend-item {
            display: flex;
            align-items: center;
            padding: 16px;
        }
        
        .friend-avatar {
            flex-shrink: 0;
            margin-right: 16px;
        }
        
        .friend-info {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        
        .friend-name {
            font-size: 14px !important;
            font-weight: 400 !important;
            margin: 0 !important;
        }
        
        .friend-status {
            font-size: 12px;
            font-weight: 400;
        }
        
        .friend-status.online {
            font-weight: 400;
        }
        
        .friend-actions {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-left: auto;
        }
        
        /* 优化消息列表项布局 */
        .message-item {
            display: flex;
            align-items: center;
            padding: 16px;
        }
        
        .message-avatar {
            flex-shrink: 0;
            margin-right: 16px;
        }
        
        .message-content {
            flex: 1;
        }
        
        .message-name {
            font-size: 14px;
            font-weight: 400;
        }
        
        /* 优化群组列表项布局 */
        .friend-list .friend-item {
            display: flex;
            align-items: center;
        }
        
        .friend-list .friend-info {
            flex: 1;
        }
        
        /* 优化群组管理按钮样式 */
        .action-btn {
            font-weight: 400 !important;
            font-size: 12px !important;
            padding: 6px 12px !important;
            margin-left: 0 !important;
        }
        
        .action-btn + .action-btn {
            margin-left: 8px !important;
        }
        
        .chat-container {
            background: var(--card-bg);
            border-radius: 20px;
            overflow: hidden;
            margin-top: 10px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            height: calc(100% - 20px);
        }
        
        .chat-header {
            background: linear-gradient(90deg, var(--primary) 0%, var(--primary-dark) 100%);
            padding: 16px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            color: white;
        }
        
        .chat-header-actions {
            display: flex;
            align-items: center;
            gap: 12px;
            position: relative;
        }
        
        .chat-actions-dropdown {
            width: 32px;
            height: 32px;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 14px;
        }
        
        .chat-actions-dropdown:hover {
            background: rgba(255, 255, 255, 0.25);
        }
        
        .chat-actions-menu {
            position: absolute;
            top: calc(100% + 8px);
            right: 0;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            border: 1px solid var(--border-color);
            min-width: 120px;
            z-index: 1000;
            display: none;
            overflow: hidden;
        }
        
        .chat-user {
            display: flex;
            align-items: center;
        }
        
        .chat-user-avatar {
            width: 44px;
            height: 44px;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.2);
            margin-right: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: white;
            font-weight: 700;
        }
        
        .chat-user-info {
            flex: 1;
        }
        
        .chat-user-name {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 4px;
        }
        
        .chat-user-status {
            font-size: 13px;
            color: rgba(255, 255, 255, 0.9);
        }
        
        .chat-messages {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            background: #f8f9fa;
            display: flex;
            flex-direction: column;
        }
        
        .message-bubble {
            max-width: 75%;
            margin-bottom: 12px;
            position: relative;
            display: flex;
            flex-direction: column;
        }
        
        .message-bubble.received {
            align-self: flex-start;
        }
        
        .message-bubble.sent {
            align-self: flex-end;
        }
        
        .bubble-content {
            padding: 10px 14px;
            border-radius: 20px;
            font-size: 15px;
            line-height: 1.4;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
        }
        
        .received .bubble-content {
            background: white;
            color: var(--text-primary);
            border-bottom-left-radius: 4px;
        }
        
        .sent .bubble-content {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            border-bottom-right-radius: 4px;
        }
        
        .bubble-time {
            font-size: 12px;
            color: var(--text-secondary);
            margin-top: 6px;
            padding: 0 8px;
        }
        
        .received .bubble-time {
            text-align: left;
        }
        
        .sent .bubble-time {
            text-align: right;
        }
        
        .stock-card-message {
            background: white;
            border-radius: 16px;
            padding: 16px;
            margin: 8px 0;
            border: 1px solid var(--border-color);
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
        }
        
        .stock-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .stock-card-name {
            font-size: 16px;
            font-weight: 700;
            color: var(--text-primary);
        }
        
        .stock-card-price {
            font-size: 20px;
            font-weight: 800;
            color: var(--danger);
        }
        
        .stock-card-change {
            font-size: 14px;
            font-weight: 700;
            color: var(--danger);
            margin-bottom: 12px;
        }
        
        .stock-card-actions {
            display: flex;
            gap: 12px;
        }
        
        .stock-card-btn {
            flex: 1;
            padding: 10px 0;
            border: 1px solid var(--primary);
            color: var(--primary);
            border-radius: 16px;
            font-size: 14px;
            font-weight: 600;
            background: transparent;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
        }
        
        .stock-card-btn:hover {
            background: var(--primary);
            color: white;
        }
        
        .chat-input-area {
            padding: 12px 15px;
            border-top: 1px solid rgba(0, 0, 0, 0.05);
            background: white;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .input-tools {
            display: flex;
            gap: 10px;
        }
        
        .tool-btn {
            width: 40px;
            height: 40px;
            border: none;
            background: #f0f2f5;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 18px;
            color: var(--text-primary);
            transition: all 0.2s;
        }
        
        .tool-btn:hover {
            background: #e4e8f0;
            transform: scale(1.05);
        }
        
        .message-input {
            flex: 1;
            padding: 12px 18px;
            border: 1px solid var(--border-color);
            border-radius: 24px;
            font-size: 15px;
            outline: none;
            background: #f8f9fa;
            transition: all 0.2s;
        }
        
        .message-input:focus {
            border-color: var(--primary);
            background: white;
            box-shadow: 0 0 0 2px rgba(26, 115, 232, 0.1);
        }
        
        .send-btn {
            padding: 12px 24px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            border: none;
            border-radius: 24px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 2px 8px rgba(26, 115, 232, 0.2);
        }
        
        .send-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(26, 115, 232, 0.3);
        }
        
        .send-btn:disabled {
            background: #dadce0;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .fixed-bottom-nav {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--card-bg);
            display: flex;
            padding: 8px 0;
            border-top: 1px solid var(--border-color);
            height: 60px;
            z-index: 999;
            box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.05);
        }
        
        .nav-item {
            flex: 1;
            text-align: center;
            color: var(--text-secondary);
            text-decoration: none;
            padding: 8px 0;
            transition: all 0.2s;
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .nav-item.active {
            color: var(--primary);
        }
        
        .nav-item.active::after {
            content: '';
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 40px;
            height: 4px;
            background: var(--primary);
            border-radius: 0 0 4px 4px;
        }
        
        .nav-icon {
            font-size: 24px;
            margin-bottom: 6px;
        }
        
        .nav-text {
            font-size: 13px;
            font-weight: 600;
        }
        
        .scrollable-content::-webkit-scrollbar {
            width: 4px;
        }
        
        .scrollable-content::-webkit-scrollbar-track {
            background: transparent;
        }
        
        .scrollable-content::-webkit-scrollbar-thumb {
            background: rgba(0, 0, 0, 0.1);
            border-radius: 4px;
        }
        
        .chat-messages::-webkit-scrollbar {
            width: 4px;
        }
        
        .chat-messages::-webkit-scrollbar-track {
            background: transparent;
        }
        
        .chat-messages::-webkit-scrollbar-thumb {
            background: rgba(0, 0, 0, 0.1);
            border-radius: 4px;
        }
        
        /* 确保内容区域在滚动时可以完整显示顶部 */
        .scrollable-content::before {
            content: '';
            display: block;
            height: 10px;
            width: 100%;
        }
        
        /* 自定义确认对话框样式 */
        .custom-confirm-dialog {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
        }
        
        .confirm-dialog-content {
            background: white;
            border-radius: 16px;
            padding: 24px;
            width: 300px;
            max-width: 90%;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            text-align: center;
        }
        
        .confirm-dialog-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 16px;
            color: var(--text-primary);
        }
        
        .confirm-dialog-message {
            font-size: 15px;
            color: var(--text-secondary);
            margin-bottom: 24px;
            line-height: 1.5;
        }
        
        .confirm-dialog-buttons {
            display: flex;
            gap: 12px;
            justify-content: center;
        }
        
        .confirm-dialog-btn {
            padding: 10px 20px;
            border-radius: 24px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
            min-width: 80px;
        }
        
        .confirm-dialog-btn.cancel {
            background: #f0f2f5;
            color: var(--text-primary);
        }
        
        .confirm-dialog-btn.cancel:hover {
            background: #e4e8f0;
        }
        
        .confirm-dialog-btn.confirm {
            background: var(--danger);
            color: white;
        }
        
        .confirm-dialog-btn.confirm:hover {
            background: #d33b2c;
        }

        /* 模态框样式 - 智能鑫系统标准设计 */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            width: 320px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
        }

        .modal-header {
            padding: 22px 24px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 700;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--text-secondary);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .modal-close:hover {
            background: #f0f2f5;
        }

        .modal-body {
            padding: 0 24px 24px;
        }

        /* 表单样式 */
        .modal-form {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-label {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .form-input {
            padding: 12px 16px;
            border: 1px solid var(--border-color);
            border-radius: 12px;
            font-size: 15px;
            outline: none;
            transition: all 0.2s;
        }

        .form-input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(26, 115, 232, 0.1);
        }

        .form-textarea {
            padding: 12px 16px;
            border: 1px solid var(--border-color);
            border-radius: 12px;
            font-size: 15px;
            outline: none;
            transition: all 0.2s;
            min-height: 100px;
            resize: vertical;
        }

        .form-textarea:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(26, 115, 232, 0.1);
        }

        .modal-actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            margin-top: 24px;
        }

        .modal-btn {
            padding: 10px 20px;
            border-radius: 24px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
        }

        .modal-btn.cancel {
            background: #f0f2f5;
            color: var(--text-primary);
        }

        .modal-btn.cancel:hover {
            background: #e4e8f0;
        }

        .modal-btn.confirm {
            background: linear-gradient(90deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
        }

        .modal-btn.confirm:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(26, 115, 232, 0.3);
        }
    </style>
</head>
<body>
    <div class="phone-container">
        <div class="phone-screen">
            <div class="status-bar">
                <div class="status-left">
                    <span>中国移动</span>
                    <span>4G</span>
                </div>
                <div class="status-time" id="current-time">14:30</div>
                <div class="status-icons">
                    <i class="fas fa-signal"></i>
                    <i class="fas fa-wifi"></i>
                    <i class="fas fa-battery-three-quarters"></i>
                </div>
            </div>
            
            <div class="fixed-header">
                <a class="back-btn" href="index.html">
                    <i class="fas fa-arrow-left"></i>
                </a>
                <div class="page-title">股友</div>
                <div class="header-content">
                    <div class="user-info" id="user-info">用户</div>
                    <div class="header-dropdown">
                        <button class="header-dropdown-btn" onclick="toggleHeaderDropdown()">
                            <i class="fas fa-ellipsis-v"></i>
                        </button>
                        <div class="header-dropdown-menu" id="header-dropdown-menu">
                            <div class="dropdown-item" onclick="addFriend()">
                                <i class="fas fa-user-plus"></i>
                                <span>添加好友</span>
                            </div>
                            <div class="dropdown-item" onclick="showCreateGroupModal()">
                                <i class="fas fa-users"></i>
                                <span>创建群组</span>
                            </div>
                            <div class="dropdown-item" onclick="showSearchModal()">
                                <i class="fas fa-search"></i>
                                <span>查找</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="scrollable-content" id="scrollable-content">
                <div id="messages-content" class="tab-content">
                    <div class="message-list">
                        <a class="message-item" href="javascript:void(0)" onclick="openChat('张财经')">
                            <div class="message-avatar-container">
                                <div class="message-avatar">张</div>
                            </div>
                            <div class="message-content">
                                <div class="message-header">
                                    <div class="message-name">张财经 · 金牌分析师</div>
                                    <div class="message-time">10:23</div>
                                </div>
                                <div class="message-preview">我觉得科技板块下周会有不错的表现，特别是AI概念...</div>
                            </div>
                            <div class="unread-badge">3</div>
                        </a>
                        
                        <a class="message-item" href="javascript:void(0)" onclick="openChat('李股神')">
                            <div class="message-avatar-container">
                                <div class="message-avatar">李</div>
                            </div>
                            <div class="message-content">
                                <div class="message-header">
                                    <div class="message-name">李股神</div>
                                    <div class="message-time">昨天</div>
                                </div>
                                <div class="message-preview">明天准备加仓宁德时代，你觉得这个位置怎么样？</div>
                            </div>
                        </a>
                        
                        <a class="message-item" href="javascript:void(0)" onclick="openChat('王趋势')">
                            <div class="message-avatar-container">
                                <div class="message-avatar">王</div>
                            </div>
                            <div class="message-content">
                                <div class="message-header">
                                    <div class="message-name">王趋势</div>
                                    <div class="message-time">3小时前</div>
                                </div>
                                <div class="message-preview">最近市场波动很大，建议控制仓位</div>
                            </div>
                        </a>
                        
                        <a class="message-item" href="javascript:void(0)" onclick="openChat('价值投资交流群')">
                            <div class="message-avatar-container">
                                <div class="message-avatar">群</div>
                            </div>
                            <div class="message-content">
                                <div class="message-header">
                                    <div class="message-name">价值投资交流群</div>
                                    <div class="message-time">09:45</div>
                                </div>
                                <div class="message-preview">[股票] 贵州茅台 1688.00 (+2.35%)</div>
                            </div>
                            <div class="unread-badge">12</div>
                        </a>
                        
                        <a class="message-item" href="javascript:void(0)" onclick="openChat('科技股投资圈')">
                            <div class="message-avatar-container">
                                <div class="message-avatar">群</div>
                            </div>
                            <div class="message-content">
                                <div class="message-header">
                                    <div class="message-name">科技股投资圈</div>
                                    <div class="message-time">08:30</div>
                                </div>
                                <div class="message-preview">AI板块今天表现不错，大家怎么看？</div>
                            </div>
                        </a>
                    </div>
                </div>
                
                <div id="groups-content" class="tab-content" style="display: none;">
                    <div class="friend-list">
                        <div class="friend-item">
                            <div class="friend-avatar-container" onclick="openChat('价值投资交流群')">
                                <div class="friend-avatar">群</div>
                            </div>
                            <div class="friend-info">
                                <div class="friend-name">价值投资交流群</div>
                                <div class="friend-status">268人 · 最后活跃: 10:30</div>
                            </div>
                            <div class="friend-actions">
                                <button class="action-btn" onclick="openChat('价值投资交流群')">进入</button>
                                <button class="action-btn secondary" onclick="showGroupManageModal('group1')">管理</button>
                            </div>
                        </div>
                        
                        <div class="friend-item">
                            <div class="friend-avatar-container" onclick="openChat('科技股投资圈')">
                                <div class="friend-avatar">群</div>
                            </div>
                            <div class="friend-info">
                                <div class="friend-name">科技股投资圈</div>
                                <div class="friend-status">156人 · 最后活跃: 09:15</div>
                            </div>
                            <div class="friend-actions">
                                <button class="action-btn" onclick="openChat('科技股投资圈')">进入</button>
                                <button class="action-btn secondary" onclick="showGroupManageModal('group2')">管理</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div id="chat-content" class="tab-content" style="display: none;">
                    <div class="chat-container">
                        <div class="chat-header">
                            <div class="chat-user">
                                <div class="chat-user-avatar" id="chat-user-avatar">张</div>
                                <div class="chat-user-info">
                                    <div class="chat-user-name" id="chat-user-name">张财经</div>
                                    <div class="chat-user-status">在线</div>
                                </div>
                            </div>
                            <div class="chat-header-actions">
                                <div class="chat-actions-dropdown" id="chat-actions-btn" onclick="toggleChatActions()">
                                    <i class="fas fa-ellipsis-v"></i>
                                </div>
                                <div class="chat-actions-menu" id="chat-actions-menu" style="display: none;">
                                    <div class="menu-item" onclick="viewCurrentFriendProfile()">查看资料</div>
                                    <div class="menu-item" onclick="blockCurrentFriend()">拉黑</div>
                                    <div class="menu-item danger" onclick="deleteCurrentFriend()">删除好友</div>
                                </div>
                            </div>
                            <div class="back-btn" onclick="backToMessageList()">
                                <i class="fas fa-arrow-left"></i>
                            </div>
                        </div>
                        
                        <div class="chat-messages" id="chat-messages">
                            <div class="message-bubble received">
                                <div class="bubble-content">
                                    你好！最近关注什么股票？
                                </div>
                                <div class="bubble-time">10:20</div>
                            </div>
                            
                            <div class="message-bubble sent">
                                <div class="bubble-content">
                                    我在看科技板块，特别是AI相关的股票
                                </div>
                                <div class="bubble-time">10:21</div>
                            </div>
                            
                            <div class="message-bubble received">
                                <div class="bubble-content">
                                    我觉得科大讯飞不错，最近资金流入明显
                                </div>
                                <div class="bubble-time">10:22</div>
                            </div>
                            
                            <div class="message-bubble received">
                                <div class="bubble-content">
                                    <div class="stock-card-message">
                                        <div class="stock-card-header">
                                            <div class="stock-card-name">科大讯飞 (002230)</div>
                                            <div class="stock-card-price">56.78</div>
                                        </div>
                                        <div class="stock-card-change">+4.5%</div>
                                        <div class="stock-card-actions">
                                            <button class="stock-card-btn" onclick="addToFavorites('科大讯飞', '002230')">加自选</button>
                                            <button class="stock-card-btn" onclick="viewStockDetail('002230')">查看详情</button>
                                        </div>
                                    </div>
                                </div>
                                <div class="bubble-time">10:23</div>
                            </div>
                        </div>
                        
                        <div class="chat-input-area">
                            <div class="input-tools">
                                <button class="tool-btn" onclick="showStockPicker()">
                                    <i class="fas fa-chart-line"></i>
                                </button>
                                <button class="tool-btn">
                                    <i class="far fa-smile"></i>
                                </button>
                            </div>
                            <input type="text" class="message-input" id="messageInput" placeholder="输入消息..." onkeypress="handleKeyPress(event)">
                            <button class="send-btn" id="sendBtn" onclick="sendMessage()">发送</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="fixed-bottom-nav">
                <a class="nav-item" href="index.html">
                    <div class="nav-icon"><i class="fas fa-home"></i></div>
                    <div class="nav-text">首页</div>
                </a>
                <a class="nav-item" href="interaction.html">
                    <div class="nav-icon"><i class="fas fa-bullseye"></i></div>
                    <div class="nav-text">互动点盘</div>
                </a>
                <a class="nav-item active" href="friends.html">
                    <div class="nav-icon"><i class="fas fa-users"></i></div>
                    <div class="nav-text">股友</div>
                </a>
                <a class="nav-item" href="profile.html">
                    <div class="nav-icon"><i class="fas fa-user"></i></div>
                    <div class="nav-text">我的</div>
                </a>
            </div>
        </div>
    </div>
    
    <!-- 添加好友模态框 -->
    <div class="modal-overlay" id="addFriendModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">添加好友</div>
                <button class="modal-close" onclick="closeAddFriendModal()">×</button>
            </div>
            <div class="modal-body">
                <form class="modal-form">
                    <div class="form-group">
                        <label class="form-label">好友昵称/ID</label>
                        <input type="text" class="form-input" placeholder="请输入好友昵称或ID">
                    </div>
                    <div class="form-group">
                        <label class="form-label">验证消息</label>
                        <textarea class="form-textarea" placeholder="请输入验证消息（可选）"></textarea>
                    </div>
                    <div class="modal-actions">
                        <button type="button" class="modal-btn cancel" onclick="closeAddFriendModal()">取消</button>
                        <button type="submit" class="modal-btn confirm">发送请求</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <!-- 创建群组模态框 -->
    <div class="modal-overlay" id="createGroupModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">创建群组</div>
                <button class="modal-close" onclick="closeCreateGroupModal()">×</button>
            </div>
            <div class="modal-body">
                <form class="modal-form">
                    <div class="form-group">
                        <label class="form-label">群组名称</label>
                        <input type="text" class="form-input" placeholder="请输入群组名称">
                    </div>
                    <div class="form-group">
                        <label class="form-label">群组简介</label>
                        <textarea class="form-textarea" placeholder="请输入群组简介（可选）"></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">隐私设置</label>
                        <div style="display: flex; gap: 12px;">
                            <label style="display: flex; align-items: center; gap: 6px;">
                                <input type="radio" name="privacy" value="public" checked>
                                <span>公开</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 6px;">
                                <input type="radio" name="privacy" value="private">
                                <span>私密</span>
                            </label>
                        </div>
                    </div>
                    <div class="modal-actions">
                        <button type="button" class="modal-btn cancel" onclick="closeCreateGroupModal()">取消</button>
                        <button type="submit" class="modal-btn confirm">创建群组</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <!-- 查找模态框 -->
    <div class="modal-overlay" id="searchModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">查找</div>
                <button class="modal-close" onclick="closeSearchModal()">×</button>
            </div>
            <div class="modal-body">
                <form class="modal-form">
                    <div class="form-group">
                        <label class="form-label">查找内容</label>
                        <input type="text" class="form-input" placeholder="请输入好友昵称、ID或群组名称">
                    </div>
                    <div class="form-group">
                        <label class="form-label">查找范围</label>
                        <div style="display: flex; gap: 12px; flex-wrap: wrap;">
                            <label style="display: flex; align-items: center; gap: 6px;">
                                <input type="checkbox" name="searchType" value="friends" checked>
                                <span>好友</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 6px;">
                                <input type="checkbox" name="searchType" value="groups">
                                <span>群组</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 6px;">
                                <input type="checkbox" name="searchType" value="publicGroups">
                                <span>公开群组</span>
                            </label>
                        </div>
                    </div>
                    <div class="modal-actions">
                        <button type="button" class="modal-btn cancel" onclick="closeSearchModal()">取消</button>
                        <button type="submit" class="modal-btn confirm">开始查找</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <!-- 好友资料模态框 -->
    <div class="modal-overlay" id="friendProfileModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">好友资料</div>
                <button class="modal-close" onclick="closeFriendProfileModal()">×</button>
            </div>
            <div class="modal-body" style="padding: 24px;">
                <div id="friendProfileContent">
                    <!-- 好友资料内容将通过JavaScript动态生成 -->
                </div>
                <div class="modal-actions" style="margin-top: 24px;">
                    <button type="button" class="modal-btn confirm" onclick="closeFriendProfileModal()">关闭</button>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // 模拟好友数据
        let friendsList = [
            { id: '1001', name: '张财经', status: 'online', avatar: '张' },
            { id: '1002', name: '李股神', status: '2小时前活跃', avatar: '李' },
            { id: '1003', name: '王趋势', status: 'online', avatar: '王' }
        ];

        document.addEventListener('DOMContentLoaded', function() {
            // 更新时间
            function updateTime() {
                const now = new Date();
                const hours = now.getHours().toString().padStart(2, '0');
                const minutes = now.getMinutes().toString().padStart(2, '0');
                document.getElementById('current-time').textContent = `${hours}:${minutes}`;
            }
            updateTime();
            setInterval(updateTime, 60000);

            // 检查并更新登录状态
            function checkLoginStatus() {
                const currentUser = localStorage.getItem('currentUser');
                const loginStatusEl = document.querySelector('.login-status');
                
                if (loginStatusEl) {
                    if (currentUser) {
                        // 用户已登录，显示用户名
                        const user = JSON.parse(currentUser);
                        loginStatusEl.innerHTML = `
                            <i class="fas fa-user-circle"></i>
                            <span>${user.username}</span>
                        `;
                        // 移除登录跳转事件，或者添加用户菜单功能
                        loginStatusEl.removeEventListener('click', loginClickHandler);
                        loginStatusEl.addEventListener('click', function() {
                            window.location.href = 'profile.html';
                        });
                    } else {
                        // 用户未登录，显示登录/注册
                        loginStatusEl.innerHTML = `
                            <i class="fas fa-user-circle"></i>
                            <span>登录/注册</span>
                        `;
                        loginStatusEl.addEventListener('click', loginClickHandler);
                    }
                }
            }
            
            function loginClickHandler() {
                window.location.href = 'login.html?back=friends.html';
            }
            
            // 初始化登录状态
            checkLoginStatus();

            // 按钮点击效果
            document.querySelectorAll('.action-btn, .stock-card-btn, .add-friend-btn, .send-btn').forEach(item => {
                item.addEventListener('click', function(e) {
                    if (window.innerWidth <= 768) {
                        this.style.transform = 'scale(0.97)';
                        setTimeout(() => this.style.transform = '', 150);
                    }
                });
            });

            // 底部导航交互
            const bottomNav = document.querySelector('.fixed-bottom-nav');
            if (bottomNav) {
                bottomNav.addEventListener('click', function(e) {
                    const navItem = e.target.closest('.nav-item');
                    if (navItem) {
                        e.preventDefault();
                        document.querySelectorAll('.nav-item').forEach(item => {
                            item.classList.remove('active');
                        });
                        navItem.classList.add('active');
                        const href = navItem.getAttribute('href');
                        if (href && href !== '#') {
                            setTimeout(() => {
                                window.location.href = href;
                            }, 300);
                        }
                    }
                });
            }

            // 初始化发送按钮状态
            const messageInput = document.getElementById('messageInput');
            const sendBtn = document.getElementById('sendBtn');
            if (messageInput && sendBtn) {
                messageInput.addEventListener('input', function() {
                    sendBtn.disabled = !this.value.trim();
                });
                // 初始状态
                sendBtn.disabled = !messageInput.value.trim();
            }

            // 初始滚动位置
            const scrollArea = document.getElementById('scrollable-content');
            if (scrollArea) scrollArea.scrollTo(0, 0);

            // 初始化搜索功能
            const searchInput = document.getElementById('addFriendSearchInput');
            if (searchInput) {
                searchInput.addEventListener('input', function() {
                    const query = this.value.trim();
                    const searchResultsList = document.getElementById('searchResultsList');
                    
                    if (query) {
                        const results = searchUsers(query);
                        renderSearchResults(results);
                    } else {
                        searchResultsList.innerHTML = '';
                    }
                });
            }
            
            // 点击模态框外部关闭
            const modal = document.getElementById('addFriendModal');
            if (modal) {
                modal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        closeAddFriendModal();
                    }
                });
            }
            
            // 初始化好友列表和群组列表
            updateFriendsList();
            updateGroupsList();
        });

        // 检查登录状态
        function checkLogin() {
            const currentUser = localStorage.getItem('currentUser');
            console.log('[checkLogin] currentUser:', currentUser);
            if (!currentUser) {
                // 允许未登录用户查看聊天界面
                return true;
            }
            return true;
        }
        
        // 切换聊天窗口操作菜单
        function toggleChatActions() {
            const menu = document.getElementById('chat-actions-menu');
            if (menu) {
                const currentDisplay = menu.style.display;
                menu.style.display = currentDisplay === 'block' ? 'none' : 'block';
                console.log('[toggleChatActions] menu display set to:', menu.style.display);
            } else {
                console.error('[toggleChatActions] menu element not found');
            }
        }
        
        // 切换顶部下拉菜单
        function toggleHeaderDropdown() {
            const menu = document.getElementById('header-dropdown-menu');
            menu.classList.toggle('show');
        }

        // 点击页面其他地方关闭所有菜单
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.chat-header-actions')) {
                const chatMenu = document.getElementById('chat-actions-menu');
                if (chatMenu) {
                    chatMenu.style.display = 'none';
                }
            }
            
            // 关闭好友操作菜单
            if (!e.target.closest('.friend-avatar-container')) {
                document.querySelectorAll('.friend-actions-menu').forEach(menu => {
                    menu.style.display = 'none';
                });
            }
            
            // 关闭顶部下拉菜单
            if (!e.target.closest('.header-dropdown')) {
                const headerMenu = document.getElementById('header-dropdown-menu');
                if (headerMenu) {
                    headerMenu.classList.remove('show');
                }
            }
        });

        // 更新用户信息显示
        function updateUserInfoDisplay() {
            const userInfoEl = document.getElementById('user-info');
            if (userInfoEl) {
                const currentUser = localStorage.getItem('currentUser');
                if (currentUser) {
                    const user = JSON.parse(currentUser);
                    userInfoEl.textContent = user.username;
                } else {
                    userInfoEl.textContent = '游客';
                }
            }
        }

        // 初始化模态框事件
        function initModalEvents() {
            // 点击模态框外部关闭模态框
            const modals = document.querySelectorAll('.modal-overlay');
            modals.forEach(modal => {
                modal.addEventListener('click', function(e) {
                    if (e.target === modal) {
                        modal.style.display = 'none';
                    }
                });
            });

            // 阻止模态框表单默认提交行为
            const modalForms = document.querySelectorAll('.modal-form');
            modalForms.forEach(form => {
                form.addEventListener('submit', function(e) {
                    e.preventDefault();
                    // 这里可以添加表单提交逻辑
                    console.log('表单提交:', form);
                    
                    // 关闭对应的模态框
                    const modal = form.closest('.modal-overlay');
                    if (modal) {
                        modal.style.display = 'none';
                    }
                });
            });
        }

        // 在DOM加载完成后更新用户信息和初始化模态框
        document.addEventListener('DOMContentLoaded', function() {
            updateUserInfoDisplay();
            initModalEvents();
        });

        // 查看当前好友资料
        function viewCurrentFriendProfile() {
            if (!currentChat) return;
            const friend = friendsList.find(f => f.name === currentChat);
            if (friend) {
                viewFriendProfile(friend.id);
            }
            toggleChatActions(); // 关闭菜单
        }
        
        // 拉黑当前好友
        function blockCurrentFriend() {
            if (!currentChat) return;
            const friend = friendsList.find(f => f.name === currentChat);
            if (friend) {
                blockFriend(friend.id);
            }
            toggleChatActions(); // 关闭菜单
        }
        
        // 删除当前好友
        function deleteCurrentFriend() {
            if (!currentChat) return;
            const friend = friendsList.find(f => f.name === currentChat);
            if (friend) {
                deleteFriend(friend.id);
            }
            toggleChatActions(); // 关闭菜单
        }

        let currentTab = 'messages';
        let currentChat = null;

        // 标签切换
        function switchChatTab(tabName, event) {
            // 添加登录检查
            if (!checkLogin()) return;

            currentTab = 'messages';

            // 更新tab激活状态
            document.querySelectorAll('.chat-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            if (event && event.target) {
                event.target.classList.add('active');
            }

            // 显示对应内容
            document.querySelectorAll('.tab-content').forEach(content => {
                content.style.display = 'none';
            });

            if (currentChat) {
                document.getElementById('chat-content').style.display = 'block';
            } else {
                // 只显示消息标签页
                document.getElementById('messages-content').style.display = 'block';
            }
        }
        
        // 打开聊天
        function openChat(userName) {
            console.log('[openChat] called with userName:', userName);
            
            // 添加登录检查
            if (!checkLogin()) return;

            currentChat = userName;
            console.log('[openChat] currentChat set to:', currentChat);
            
            document.getElementById('chat-user-name').textContent = userName;
            document.getElementById('chat-user-avatar').textContent = userName.charAt(0);

            // 隐藏其他内容，显示聊天界面
            document.querySelectorAll('.tab-content').forEach(content => {
                content.style.display = 'none';
            });
            
            const chatContent = document.getElementById('chat-content');
            console.log('[openChat] chatContent:', chatContent);
            chatContent.style.display = 'block';
            console.log('[openChat] chatContent display set to:', chatContent.style.display);

            // 滚动到底部
            scrollToBottom();
        }

        // 返回消息列表
        function backToMessageList() {
            currentChat = null;
            document.querySelectorAll('.tab-content').forEach(content => {
                content.style.display = 'none';
            });
            document.getElementById(currentTab + '-content').style.display = 'block';
        }

        // 发送消息
        function sendMessage() {
            // 添加登录检查
            if (!checkLogin()) return;

            const input = document.getElementById('messageInput');
            const message = input.value.trim();

            if (message) {
                // 添加发送的消息
                addMessage(message, 'sent');
                input.value = '';

                // 模拟回复
                setTimeout(() => {
                    const replies = [
                        '这个观点很有意思！',
                        '我也有同感',
                        '你觉得明天会怎么走？',
                        '可以参考一下技术面'
                    ];
                    const randomReply = replies[Math.floor(Math.random() * replies.length)];
                    addMessage(randomReply, 'received');
                }, 1000);
            }
        }
        
        // 添加消息
        function addMessage(text, type) {
            const messagesContainer = document.getElementById('chat-messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message-bubble ${type}`;
            
            const now = new Date();
            const timeString = `${now.getHours()}:${now.getMinutes().toString().padStart(2, '0')}`;
            
            messageDiv.innerHTML = `
                <div class="bubble-content">${text}</div>
                <div class="bubble-time">${timeString}</div>
            `;
            
            messagesContainer.appendChild(messageDiv);
            scrollToBottom();
        }
        
        // 滚动到底部
        function scrollToBottom() {
            const messagesContainer = document.getElementById('chat-messages');
            if (messagesContainer) {
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            }
        }
        
        // 处理按键
        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        // 显示股票选择器
        function showStockPicker() {
            if (!checkLogin()) return;
            const stockCode = prompt('请输入股票代码：');
            if (stockCode) {
                // 模拟发送股票卡片
                addStockCard('示例股票', stockCode, 100.00, 2.5);
            }
        }

        // 添加股票卡片
        function addStockCard(name, code, price, change) {
            const messagesContainer = document.getElementById('chat-messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message-bubble sent';

            const now = new Date();
            const timeString = `${now.getHours()}:${now.getMinutes().toString().padStart(2, '0')}`;

            messageDiv.innerHTML = `
                <div class="bubble-content">
                    <div class="stock-card-message">
                        <div class="stock-card-header">
                            <div class="stock-card-name">${name} (${code})</div>
                            <div class="stock-card-price">${price.toFixed(2)}</div>
                        </div>
                        <div class="stock-card-change">${change >= 0 ? '+' : ''}${change}%</div>
                        <div class="stock-card-actions">
                            <button class="stock-card-btn" onclick="addToFavorites('${name}', '${code}')">加自选</button>
                            <button class="stock-card-btn" onclick="viewStockDetail('${code}')">查看详情</button>
                        </div>
                    </div>
                </div>
                <div class="bubble-time">${timeString}</div>
            `;

            messagesContainer.appendChild(messageDiv);
            scrollToBottom();
        }

        // 添加到自选股
        function addToFavorites(stockName, stockCode) {
            if (!checkLogin()) return;
            alert(`已添加 ${stockName}(${stockCode}) 到自选股`);
        }

        // 查看股票详情
        function viewStockDetail(stockCode) {
            if (!checkLogin()) return;
            console.log('查看股票详情:', stockCode);
            // 实际应用中这里会跳转到股票详情页
        }
        
        // 好友资料相关功能
        
        // 查看好友资料
        function viewFriendProfile(friendId) {
            if (!checkLogin()) return;
            const friend = friendsList.find(f => f.id === friendId);
            if (!friend) return;
            
            // 模拟好友详细资料
            const friendDetails = {
                ...friend,
                phone: '13800138000',
                location: '北京市朝阳区',
                gender: '男',
                birthday: '1985-01-01',
                signature: '股市有风险，投资需谨慎',
                mutualFriends: 23
            };
            
            // 显示好友资料
            showFriendProfileModal(friendDetails);
        }
        
        // 拉黑好友
        function blockFriend(friendId) {
            if (!checkLogin()) return;
            if (confirm('确定要拉黑该好友吗？')) {
                const friend = friendsList.find(f => f.id === friendId);
                if (friend) {
                    // 这里可以添加拉黑逻辑，例如从好友列表移除或标记为拉黑状态
                    friendsList = friendsList.filter(f => f.id !== friendId);
                    updateFriendsList();
                    alert(`已拉黑好友 ${friend.name}`);
                }
            }
        }
        
        // 删除好友
        function deleteFriend(friendId) {
            console.log('[deleteFriend] called with friendId:', friendId);
            
            if (!checkLogin()) return;
            
            const friend = friendsList.find(f => f.id === friendId);
            console.log('[deleteFriend] found friend:', friend);
            
            if (!friend) return;
            
            // 显示自定义确认对话框
            showDeleteFriendConfirmDialog(friend);
        }
        
        // 显示删除好友确认对话框
        function showDeleteFriendConfirmDialog(friend) {
            // 创建对话框元素
            const dialog = document.createElement('div');
            dialog.className = 'custom-confirm-dialog';
            dialog.innerHTML = `
                <div class="confirm-dialog-content">
                    <div class="confirm-dialog-title">删除好友</div>
                    <div class="confirm-dialog-message">确定要删除好友 "${friend.name}" 吗？删除后将无法恢复聊天记录。</div>
                    <div class="confirm-dialog-buttons">
                        <button class="confirm-dialog-btn cancel" onclick="closeDeleteFriendDialog()">取消</button>
                        <button class="confirm-dialog-btn confirm" onclick="confirmDeleteFriend('${friend.id}', '${friend.name}')">删除</button>
                    </div>
                </div>
            `;
            
            // 添加到页面
            document.body.appendChild(dialog);
            
            // 保存对话框引用以便后续关闭
            window.currentDeleteDialog = dialog;
        }
        
        // 关闭删除好友对话框
        function closeDeleteFriendDialog() {
            if (window.currentDeleteDialog) {
                document.body.removeChild(window.currentDeleteDialog);
                window.currentDeleteDialog = null;
            }
        }
        
        // 确认删除好友
        function confirmDeleteFriend(friendId, friendName) {
            console.log('[confirmDeleteFriend] called with friendId:', friendId, 'friendName:', friendName);
            
            console.log('[confirmDeleteFriend] friendsList before deletion:', friendsList);
            
            // 从好友列表中移除
            friendsList = friendsList.filter(f => f.id !== friendId);
            console.log('[confirmDeleteFriend] friendsList after deletion:', friendsList);
            
            // 更新好友列表UI
            updateFriendsList();
            console.log('[confirmDeleteFriend] updateFriendsList called');
            
            // 如果当前正在与该好友聊天，关闭聊天窗口
            if (currentChat === friendName) {
                backToMessageList();
            }
            
            // 关闭对话框
            closeDeleteFriendDialog();
            
            // 显示成功提示
            showSuccessMessage(`已删除好友 ${friendName}`);
            console.log('[confirmDeleteFriend] deletion complete');
        }
        
        // 显示成功消息
        function showSuccessMessage(message) {
            // 创建成功提示元素
            const toast = document.createElement('div');
            toast.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: rgba(0, 0, 0, 0.7);
                color: white;
                padding: 12px 24px;
                border-radius: 24px;
                font-size: 14px;
                z-index: 10001;
                max-width: 80%;
                text-align: center;
            `;
            toast.textContent = message;
            
            // 添加到页面
            document.body.appendChild(toast);
            
            // 2秒后自动移除
            setTimeout(() => {
                document.body.removeChild(toast);
            }, 2000);
        }
        
        // 更新好友列表
        function updateFriendsList() {
            console.log('[updateFriendsList] called with friendsList:', friendsList);
            const friendListContainer = document.querySelector('#friends-content .friend-list');
            if (friendListContainer) {
                friendListContainer.innerHTML = '';
                
                friendsList.forEach(friend => {
                    const friendItem = document.createElement('div');
                    friendItem.className = 'friend-item';
                    friendItem.innerHTML = `
                        <div class="friend-avatar-container" onclick="openChat('${friend.name}')">
                            <div class="friend-avatar">${friend.avatar}</div>
                        </div>
                        <div class="friend-info">
                            <div class="friend-name">${friend.name}</div>
                            <div class="friend-status ${friend.status === 'online' ? 'online' : ''}">${friend.status}</div>
                        </div>
                    `;
                    friendListContainer.appendChild(friendItem);
                });
            }
        }
        
        // 群组相关功能
        
        // 模拟群组数据
        let groupsList = [
            { 
                id: 'group1', 
                name: '价值投资交流群', 
                status: '268人 · 最后活跃: 10:30', 
                avatar: '群',
                owner: 'currentUser',
                members: ['1001', '1002', '1003', 'currentUser'],
                admins: ['currentUser']
            },
            { 
                id: 'group2', 
                name: '科技股投资圈', 
                status: '156人 · 最后活跃: 09:15', 
                avatar: '群',
                owner: '1001',
                members: ['1001', '1002', 'currentUser'],
                admins: ['1001']
            }
        ];
        
        // 更新群组列表
        function updateGroupsList() {
            console.log('[updateGroupsList] called with groupsList:', groupsList);
            const groupsContainer = document.querySelector('#groups-content .friend-list');
            if (groupsContainer) {
                groupsContainer.innerHTML = '';
                
                groupsList.forEach(group => {
                    const isOwner = group.owner === 'currentUser';
                    const groupItem = document.createElement('div');
                    groupItem.className = 'friend-item';
                    groupItem.innerHTML = `
                        <div class="friend-avatar-container" onclick="openChat('${group.name}')">
                            <div class="friend-avatar">${group.avatar}</div>
                        </div>
                        <div class="friend-info">
                            <div class="friend-name">${group.name}</div>
                            <div class="friend-status">${group.status}</div>
                        </div>
                        <div class="friend-actions">
                            <button class="action-btn" onclick="openChat('${group.name}')">进入</button>
                            <button class="action-btn secondary" onclick="showGroupManageModal('${group.id}')">管理</button>
                        </div>
                    `;
                    groupsContainer.appendChild(groupItem);
                });
            }
        }
        
        // 显示好友资料模态框
        function showFriendProfileModal(friendDetails) {
            const modal = document.getElementById('friendProfileModal');
            if (modal) {
                // 动态生成好友资料内容
                const profileContent = document.getElementById('friendProfileContent');
                if (profileContent) {
                    profileContent.innerHTML = `
                        <div style="display: flex; flex-direction: column; align-items: center; margin-bottom: 24px;">
                            <div style="width: 80px; height: 80px; border-radius: 50%; background: linear-gradient(135deg, #e8f0fe 0%, #f1f8ff 100%); display: flex; align-items: center; justify-content: center; font-size: 32px; color: var(--primary); font-weight: 700; margin-bottom: 16px;">
                                ${friendDetails.avatar || friendDetails.name.charAt(0)}
                            </div>
                            <div style="font-size: 20px; font-weight: 700; margin-bottom: 4px;">${friendDetails.name}</div>
                            <div style="font-size: 14px; color: var(--text-secondary);">${friendDetails.status === 'online' ? '<span style="color: var(--secondary);">在线</span>' : friendDetails.status}</div>
                        </div>
                        
                        <div style="border-top: 1px solid var(--border-color); padding-top: 20px; margin-bottom: 20px;">
                            <div style="display: grid; grid-template-columns: 80px 1fr; gap: 12px; margin-bottom: 16px;">
                                <div style="font-size: 14px; color: var(--text-secondary); font-weight: 600;">性别</div>
                                <div style="font-size: 14px; color: var(--text-primary);">${friendDetails.gender || '未知'}</div>
                            </div>
                            
                            <div style="display: grid; grid-template-columns: 80px 1fr; gap: 12px; margin-bottom: 16px;">
                                <div style="font-size: 14px; color: var(--text-secondary); font-weight: 600;">生日</div>
                                <div style="font-size: 14px; color: var(--text-primary);">${friendDetails.birthday || '未知'}</div>
                            </div>
                            
                            <div style="display: grid; grid-template-columns: 80px 1fr; gap: 12px; margin-bottom: 16px;">
                                <div style="font-size: 14px; color: var(--text-secondary); font-weight: 600;">手机</div>
                                <div style="font-size: 14px; color: var(--text-primary);">${friendDetails.phone || '未设置'}</div>
                            </div>
                            
                            <div style="display: grid; grid-template-columns: 80px 1fr; gap: 12px; margin-bottom: 16px;">
                                <div style="font-size: 14px; color: var(--text-secondary); font-weight: 600;">所在地</div>
                                <div style="font-size: 14px; color: var(--text-primary);">${friendDetails.location || '未设置'}</div>
                            </div>
                            
                            <div style="display: grid; grid-template-columns: 80px 1fr; gap: 12px; margin-bottom: 16px;">
                                <div style="font-size: 14px; color: var(--text-secondary); font-weight: 600;">签名</div>
                                <div style="font-size: 14px; color: var(--text-primary);">${friendDetails.signature || '无'}</div>
                            </div>
                            
                            <div style="display: grid; grid-template-columns: 80px 1fr; gap: 12px;">
                                <div style="font-size: 14px; color: var(--text-secondary); font-weight: 600;">共同好友</div>
                                <div style="font-size: 14px; color: var(--text-primary);">${friendDetails.mutualFriends || 0}人</div>
                            </div>
                        </div>
                    `;
                }
                
                modal.style.display = 'flex';
            }
        }
        
        // 关闭好友资料模态框
        function closeFriendProfileModal() {
            const modal = document.getElementById('friendProfileModal');
            if (modal) {
                modal.style.display = 'none';
            }
        }
        
        // 显示添加好友模态框
        function addFriend() {
            const modal = document.getElementById('addFriendModal');
            if (modal) {
                modal.style.display = 'flex';
            }
        }
        
        // 关闭添加好友模态框
        function closeAddFriendModal() {
            const modal = document.getElementById('addFriendModal');
            if (modal) {
                modal.style.display = 'none';
            }
        }
        
        // 显示创建群组模态框
        function showCreateGroupModal() {
            const modal = document.getElementById('createGroupModal');
            if (modal) {
                modal.style.display = 'flex';
            }
        }
        
        // 关闭创建群组模态框
        function closeCreateGroupModal() {
            const modal = document.getElementById('createGroupModal');
            if (modal) {
                modal.style.display = 'none';
            }
        }
        
        // 显示搜索模态框
        function showSearchModal() {
            const modal = document.getElementById('searchModal');
            if (modal) {
                modal.style.display = 'flex';
            }
        }
        
        // 关闭搜索模态框
        function closeSearchModal() {
            const modal = document.getElementById('searchModal');
            if (modal) {
                modal.style.display = 'none';
            }
        }
        
        function showGroupManageModal(groupId) {
            alert(`显示群组 ${groupId} 管理弹窗`);
        }
        
        function searchUsers(query) {
            return friendsList.filter(user => user.name.includes(query));
        }
        
        function renderSearchResults(results) {
            console.log('渲染搜索结果:', results);
        }
    </script>
</body>
</html>